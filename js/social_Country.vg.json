{"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "A simple radial chart with embedded data.",
  "width": 1800,
  "height" :600,
  "data": {"url": "https://raw.githubusercontent.com/sookmun/FIT3179_Assignment2/main/Data/csvjson.json"},
  "params": [
    {
      "name": "Year",
      "value" : 2018,
      "bind": {
        "input": "range",
        "min": 2018,
        "max": 2021,
        "step": 1,
        "name": "Year: "
      }
    }
  ],
  "transform": [
    {"filter": "datum.Year== Year"},
    {
      "joinaggregate": [{
        "op": "average",
        "field": "Social_Support",
        "as": "Average_Social"
      }]
    }
    
  ],
  "layer": [{
    "mark": {"type":"bar","stroke": "black"},
    "encoding": {
      "x": {
        "field": "Country_Name",
        "type": "ordinal",
        "title" :"Country Name",
        "sort" : { "field": "Regional_Indicator"}
      },
      "y": {
        "field": "Social_Support",
        "type": "quantitative",
        "title" : "Median Social Support Score"
      },
      "fillOpacity": {
        "condition": {"test": "datum.Social_Support <datum.Average_Social ", "value": 1},
        "value": 0.2
      },   
      "strokeWidth" :{
        "condition": {"test": "datum.Social_Support <datum.Average_Social ", "value":1},
        "value": 0   },
      "color": {
        "field": "Regional_Indicator",
        "type": "nominal",
        "scale": {
          "domain": [
            "Western Europe",
            "North America",
            "Australia and New Zealand",
            "Middle East and North Africa",
            "Latin America and Caribbean",
            "Central and Eastern Europe",
            "East Asia",
            "Southeast Asia",
            "Commonwealth of Independent States",
            "Sub-Saharan Africa",
            "South Asia"
          ],
          "range": [
            "#a6cee3",
            "#1f78b4",
            "#b2df8a",
            "#33a02c",
            "#fb9a99",
            "#e31a1c",
            "#fdbf6f",
            "#ff7f00",
            "#cab2d6",
            "#6a3d9a",
            "#acada9"
          ]
        }
      },
      "tooltip": [
        {"field": "Country_Name", "type": "nominal","title":"Country Name"},
        {"field": "Regional_Indicator", "type": "nominal","title":"Regional Indicator"},
        {"field" : "Social_Support","type": "quantitative","title":"Social Support Score"} ,
        {"field" : "Year","type": "ordinal"}
          
      ]
    }
  }, {
    "mark": "rule",
    "encoding": {
      "y": {
        "aggregate": "average",
        "field": "Social_Support",
        "type": "quantitative"
      },
      "color": {"value": "firebrick"},
      "size": {"value": 3},
      "tooltip" :[
        {"field":"Social_Support","aggregate":"median","type": "quantitative","format":".2f","title":"World Median Social Support"}
      ]
    }
  }]
}